#!/bin/bash

. ./function.sh

# U-01
src=/etc/securetty
if [ -f $src ]; then
	if [ cat "$src" | grep -q -n "tty" ]; then
    		warn "U-01" "HIGH" "terminal-teletype service is on"
	fi

	if [ cat "$src" | grep -q -n "pts" ]; then
    		warn "U-01" "HIGH" "pseudo-terminal service is on"
	fi
else
	exception "FileNotFound" "U-01" "$src"
fi

# U-02
src=/etc/security/pwquality.conf
if [ -f $src ]; then
	value=$(getvalue "$src" "minlen")
	if [ "$value" ]; then
		if [ "$value" -lt 8 ]; then
			warn "U-02" "HIGH" "The minimum password length is less than 8"
		fi
	else
		exception "ValueNotFound" "U-02" "key=minlen"
	fi
else
	exception "FileNotFound" "U-02" "$src"
fi

# U-03
src=/etc/pam.d/system-auth
if [ -f $src ]; then
	value=$(getvalue "$src" "pam_tally.so deny")
	if [ "$value" ]; then
		if [ "$value" -g 10 ]; then
			warn "U-03" "HIGH" "Account Lockout Threshold is more then 10"
		fi
	else
		exception "ValueNotFound" "U-03" "key=deny"
	fi
else
	exception "FileNotFound" "U-03" "$src"
fi

# U-04
src=/etc/passwd
if [ -f $src ]; then
	value=$(awk -F ':' '/^root:/ {print $2}' "$src")
	if [ $value ]; then
		if [ $value != "x" ]; then
			warn "U-04" "HIGH" "/etc/passwd file saved password with plan text"
		fi
	else
		exception "ValueNotFound" "U-04" "key=root"
	fi
else
	exception "FileNotFound" "U-04" "$src"
fi