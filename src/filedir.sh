#!/bin/bash

. ./Server-Vulnerability-Scanner/function.sh

# U-05
if [ $(echo $PATH | grep -n "\.") ]; then
    warn "U-05" "HIGH" ". in \$PATH"
fi

# U-06
if [ $(find / -nouser -print 2> /dev/null) ]; then
    warn "U-06" "HIGH" "Files and directories exist without an owner $(find / -nouser -print 2> /dev/null)"
fi
if [ $(find / -nogroup -print 2> /dev/null) ]; then
    warn "U-06" "HIGH" "Files and directories exist without an owner $(find / -nogroup -print 2> /dev/null)"
fi

# U-07
dt=$(stat -c "%a" /etc/passwd)
if [ "$dt" -gt 644 ]; then
    warn "U-07" "HIGH" "/etc/passwd permissions higher than 644"
fi

# U-08
dt=$(stat -c "%a" /etc/shadow)
if [ "$dt" -gt 400 ]; then
    warn "U-08" "HIGH" "/etc/shadow permissions higher than 400"
fi

# U-09
dt=$(stat -c "%a" /etc/hosts)
if [ "$dt" -gt 600 ]; then
    warn "U-09" "HIGH" "/etc/hosts permissions higher than 600"
fi

# U-10
src=/etc/inetd.conf
if [ -f $src ]; then
    dt=$(stat -c "%a" "$src")
    if [ "$dt" != 600 ]; then
        warn "U-10" "HIGH" "$src permissions is not equal 600"
    fi
else
    exception "FileNotFound" "U-10" "$src"
fi

# U-11
src=/etc/syslog.conf
if [ -f $src ]; then
    dt=$(stat -c "%a" "$src")
    if [ "$dt" -gt 640 ]; then
        warn "U-11" "HIGH" "$src permissions is more then 600"
    fi
else
    exception "FileNotFound" "U-11" "$src"
fi

# U-12
src=/etc/services
dt=$(stat -c "%a" "$src")
if [ "$dt" -gt 644 ]; then
    warn "U-12" "HIGH" "$src permissions is more then 644"
fi
